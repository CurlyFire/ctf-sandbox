@{
    ViewData["Title"] = "IP Lookup";
}

<div class="container mt-4">
    <h2>IP Address Lookup</h2>
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                <label for="ipAddress">IP Address:</label>
                <input type="text" 
                       class="form-control" 
                       id="ipAddress" 
                       placeholder="Enter IP address (e.g., 8.8.8.8)"
                       aria-label="IP Address input"
                       aria-describedby="ipAddressHelp">
                <small id="ipAddressHelp" class="form-text text-muted d-none">Enter a valid IP address</small>
            </div>
            <button class="btn btn-primary mt-2" 
                    onclick="lookupIp()"
                    aria-label="Lookup IP address">Lookup</button>
        </div>
    </div>
    <div class="row mt-4">
        <div class="col-md-8">
            <div id="results" 
                 class="d-none" 
                 role="region" 
                 aria-label="IP lookup results"
                 aria-live="polite">
                <h3>Results</h3>
                <table class="table table-bordered" role="table" aria-label="IP information table">
                    <tbody>
                        <tr><td>IP</td><td id="ip" data-testid="result-ip"></td></tr>
                        <tr><td>Hostname</td><td id="hostname" data-testid="result-hostname"></td></tr>
                        <tr><td>City</td><td id="city" data-testid="result-city"></td></tr>
                        <tr><td>Region</td><td id="region" data-testid="result-region"></td></tr>
                        <tr><td>Country</td><td id="country" data-testid="result-country"></td></tr>
                        <tr><td>Location</td><td id="location" data-testid="result-location"></td></tr>
                        <tr><td>Organization</td><td id="org" data-testid="result-org"></td></tr>
                        <tr><td>Postal Code</td><td id="postal" data-testid="result-postal"></td></tr>
                        <tr><td>Timezone</td><td id="timezone" data-testid="result-timezone"></td></tr>
                        <tr><td>Anycast</td><td id="anycast" data-testid="result-anycast"></td></tr>
                    </tbody>
                </table>
            </div>
            <div id="error" 
                 class="alert alert-danger d-none" 
                 role="alert" 
                 aria-live="assertive"
                 aria-label="Error message"
                 data-testid="error-message"></div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function lookupIp() {
            const ipAddress = document.getElementById('ipAddress').value;
            const resultsDiv = document.getElementById('results');
            const errorDiv = document.getElementById('error');
            
            resultsDiv.classList.add('d-none');
            errorDiv.classList.add('d-none');

            fetch(`/IpLookup/Lookup?ip=${encodeURIComponent(ipAddress)}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(response.status === 400 ? 'Invalid IP address' : 'Failed to retrieve IP information');
                    }
                    return response.json();
                })
                .then(data => {
                    resultsDiv.classList.remove('d-none');
                    document.getElementById('ip').textContent = data.ip || '';
                    document.getElementById('hostname').textContent = data.hostname || '';
                    document.getElementById('city').textContent = data.city || '';
                    document.getElementById('region').textContent = data.region || '';
                    document.getElementById('country').textContent = data.country || '';
                    document.getElementById('location').textContent = data.loc || '';
                    document.getElementById('org').textContent = data.org || '';
                    document.getElementById('postal').textContent = data.postal || '';
                    document.getElementById('timezone').textContent = data.timezone || '';
                    document.getElementById('anycast').textContent = data.anycast ? 'Yes' : 'No';
                })
                .catch(error => {
                    errorDiv.textContent = error.message;
                    errorDiv.classList.remove('d-none');
                });
        }
    </script>
}
